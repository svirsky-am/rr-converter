# RN

1) Столкнулся с большими трубностями при сопоставлении проверочных файлов между собой. Например, сопоставление отчетов между собой. Пример `MT940_github_1.mt940` содержит в себе много выписок, что не ложится на camt053 и выписку от сбербанка.

Возможно сущности должны были выглядеть так:
    Выписка -> перечень аккаутнов -> перечень кошельков/счетов -> транзакции /балансы   
Сейчас реальзовано как-то так :
    Выписка -> перечень кошельков/счетов -> транзакции /балансы   


    - выписка из Сбербанка- это не "чистый" csv , а csv-фрагмент с дополнительными полями с метаинформацией. Перед парсингом csv его потребовалось еще "фиксить"
: править заголовки и убирать мешающиеся переносы в ячейках.

По результатам первого ревью было предложено пользоваться крейтами для парсинга, ни предложенный крейт, ни другие не смогли распарсить данные примеры . Ошибки парсинга были малоинформативны, поэтому пришлось писать парсер самостоятельно. К сожелению были выявлены очень досадные искажения в тестовых наборах:
- `0940` в MT940_github_1.mt940 и `O940` в MT_940_oracle.mt940.
- В этом же примере были любопытные float значения из букв `50,OO` и были лишние теги `:86`. 

Пример `MT_940_oracle.mt940` был немного подкорректирован чтобы его можно было использовать для тестов. Был подставлен числовой reference для транзакций :61 вместо `NONREF`. Вставлен {5:} чтобы унифицировать regexp с другим примером. Также были убраны лишние пробелы.т.к они принуждали усложнять regexp для парсинга. В транзакции :61 вставлены времена перевода 00:00 для унификации с `MT940_github_1.mt940`

Мелкие проблемы:
    - время транзакция для camt053 и mt940 указывается с часами и секундами, а в выписке сбербанка толлько дата. При конвертации из extrafin csv приходится вставлять 00:00.
  
    - у транзаций camt053 зафиксировано время бронирования и время подтверждения транзакции
    - сложновато было понять как сериализовать данные из xml  c помощью quick_xml+serde, поэтому была применена чуть более простая библиотека `roxml`. Но у `roxml` походе 
    - идендитификаторы виписок то int, то str (как в случае со сбербанком)
    - два примера camt053 и все три примера mt940 не похожи по структуре между собой. В примерах mt940 похоже имеется множетво выписок по нескольким кошелькам, что не сопостовляется со структорой выписки от сбербанка.
    - Не получлиось восопльзоваться предложенным парвером mt940 т.к. он не смог без ошибок спарсить ни один из примеров
    - "csv" формат от сбербанка является не классическим примером csv. перед парсингом пришлось его нормализовать .

# Персеры пока в процессе написания. 
Сборка библиотеки:
```sh
cargo build -p rr-parser-lib --verbose
```
Сборка cli-утилиты :
```sh
cargo build -p rr-file-processor --verbose
```
Запуск тестов для библиоетеки
```sh
cargo test -p rr-parser-lib --verbose
```
Запуск тестов для cli-утилиты
```sh
cargo test -p rr-file-processor --verbose
```
# Запуск утилиты (пока поломан) 
```sh
target/debug/rr-file-processor \
                --in-format csv --out-format xml \
                --input  - \
                --output output/formatted/stdin_csv_to_xml
```
# refs
https://github.com/r3bb1t/coverage_formats/blob/main/Readme.md

cargo run -p sandbox_env